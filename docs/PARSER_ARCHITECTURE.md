# Wyreframe Parser Architecture

> ASCII ì™€ì´ì–´í”„ë ˆì„ì„ ìœ„í•œ ì²´ê³„ì ì¸ 2D íŒŒì„œ ì„¤ê³„ ë¬¸ì„œ

## ëª©ì°¨

1. [ê°œìš”](#1-ê°œìš”)
2. [í˜„ì¬ êµ¬í˜„ì˜ ë¬¸ì œì ](#2-í˜„ì¬-êµ¬í˜„ì˜-ë¬¸ì œì )
3. [ì œì•ˆ ì•„í‚¤í…ì²˜](#3-ì œì•ˆ-ì•„í‚¤í…ì²˜)
4. [ìƒì„¸ ì„¤ê³„](#4-ìƒì„¸-ì„¤ê³„)
5. [ì—ëŸ¬ ì‹œìŠ¤í…œ](#5-ì—ëŸ¬-ì‹œìŠ¤í…œ)
6. [ë””ë ‰í† ë¦¬ êµ¬ì¡°](#6-ë””ë ‰í† ë¦¬-êµ¬ì¡°)
7. [êµ¬í˜„ ë¡œë“œë§µ](#7-êµ¬í˜„-ë¡œë“œë§µ)

---

## 1. ê°œìš”

### 1.1 ë°°ê²½

Wyreframeì€ ASCII í…ìŠ¤íŠ¸ ê¸°ë°˜ ì™€ì´ì–´í”„ë ˆì„ì„ HTMLë¡œ ë³€í™˜í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. í˜„ì¬ ì •ê·œì‹ ê¸°ë°˜ íŒŒì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ í•œê³„ì— ì§ë©´í•´ ìˆìŠµë‹ˆë‹¤:

- ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ì˜ ì–´ë ¤ì›€
- ë³µì¡í•œ ì—£ì§€ ì¼€ì´ìŠ¤ ì²˜ë¦¬
- ë¶ˆëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€

### 1.2 ëª©í‘œ

- **í™•ì¥ì„±**: ìƒˆë¡œìš´ ìš”ì†Œ/ë¬¸ë²•ì„ ì‰½ê²Œ ì¶”ê°€
- **ê°€ë…ì„±**: ìì—°ì–´ ê¸°ë°˜ì˜ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€
- **ì‹ ë¢°ì„±**: ì²´ê³„ì ì¸ 2D êµ¬ì¡° íŒŒì‹±
- **ìœ ì§€ë³´ìˆ˜ì„±**: ë‹¨ê³„ë³„ ë¶„ë¦¬ë¡œ í…ŒìŠ¤íŠ¸ ë° ë””ë²„ê¹… ìš©ì´

### 1.3 í•µì‹¬ ì•„ì´ë””ì–´

ASCII ì™€ì´ì–´í”„ë ˆì„ì€ ì¼ë°˜ í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ **2D ì‹œê°ì  êµ¬ì¡°**ì…ë‹ˆë‹¤. ë”°ë¼ì„œ 1D ìŠ¤íŠ¸ë¦¼ íŒŒì‹±ì´ ì•„ë‹Œ **ê·¸ë¦¬ë“œ ê¸°ë°˜ ë„í˜• ì¸ì‹** ì ‘ê·¼ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Grid    â”‚ â†’  â”‚  2. Shape   â”‚ â†’  â”‚  3. Semanticâ”‚
â”‚  Scanner    â”‚    â”‚  Detector   â”‚    â”‚  Parser     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   2D ê·¸ë¦¬ë“œí™”        ë„í˜• ì¸ì‹          ì˜ë¯¸ ë¶„ì„
```

---

## 2. í˜„ì¬ êµ¬í˜„ì˜ ë¬¸ì œì 

### 2.1 ì •ê·œì‹ ê¸°ë°˜ íŒŒì‹±ì˜ í•œê³„

| ë¬¸ì œ | ì„¤ëª… | ì˜í–¥ |
|------|------|------|
| **ìˆœì„œ ì˜ì¡´ì„±** | ì •ê·œì‹ ë§¤ì¹­ ìˆœì„œì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ë¼ì§ | ë²„ê·¸ ë°œìƒ ê°€ëŠ¥ì„± |
| **ì»¨í…ìŠ¤íŠ¸ ë¬´ì‹œ** | ë¼ì¸ ë‹¨ìœ„ ì²˜ë¦¬ë¡œ ì „ì²´ êµ¬ì¡° íŒŒì•… ì–´ë ¤ì›€ | ì¤‘ì²© ë°•ìŠ¤ ì²˜ë¦¬ ë³µì¡ |
| **ìœ„ì¹˜ ì •ë³´ ì†ì‹¤** | ì—ëŸ¬ ë°œìƒ ì‹œ ì •í™•í•œ ìœ„ì¹˜ íŠ¹ì • ë¶ˆê°€ | ë””ë²„ê¹… ì–´ë ¤ì›€ |
| **2D êµ¬ì¡° ë¯¸ë°˜ì˜** | ë°•ìŠ¤ ê²½ê³„ì˜ ê¸°í•˜í•™ì  ê´€ê³„ ë¬´ì‹œ | ì •ë ¬ ê³„ì‚° ë¶€ì •í™• |

### 2.2 êµ¬ì²´ì ì¸ ë¬¸ì œ ì‚¬ë¡€

```
+---------------------------+
|  +-------------------+    |
|  | Nested Box        |    |   â† ì¤‘ì²© ë°•ìŠ¤ ê°ì§€ ì–´ë ¤ì›€
|  +-------------------+    |
|                           |
|  [ Button ]               |   â† ì •ë ¬ ê³„ì‚° ë¶ˆì •í™•
+---------------------------+
```

**í˜„ì¬ ë°©ì‹ì˜ ë¬¸ì œ:**
1. `depth` ì¹´ìš´í„°ë¡œ ì¤‘ì²© ì¶”ì  â†’ ë³µì¡í•œ ì¼€ì´ìŠ¤ì—ì„œ ì‹¤íŒ¨
2. ì •ë ¬ ê³„ì‚°ì´ ë¬¸ì ë¹„ìœ¨ì— ì˜ì¡´ â†’ ë°•ìŠ¤ ê²½ê³„ ê¸°ì¤€ ì•„ë‹˜
3. ë°•ìŠ¤ ê²½ê³„ ë¶ˆì¼ì¹˜ ê°ì§€ ë¶ˆê°€

---

## 3. ì œì•ˆ ì•„í‚¤í…ì²˜

### 3.1 3ë‹¨ê³„ íŒŒì´í”„ë¼ì¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Input (ASCII)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     1. Grid Scanner                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ ì…ë ¥ì„ 2D ë¬¸ì ê·¸ë¦¬ë“œë¡œ ë³€í™˜                          â”‚  â”‚
â”‚  â”‚ â€¢ ê° ë¬¸ìì˜ (row, col) ì¢Œí‘œ ë¶€ì—¬                        â”‚  â”‚
â”‚  â”‚ â€¢ íŠ¹ìˆ˜ ë¬¸ì ìœ„ì¹˜ ì¸ë±ì‹± (+, -, |, =)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2. Shape Detector                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ ì½”ë„ˆ(+) ê¸°ë°˜ ë°•ìŠ¤ ê²½ê³„ ì¶”ì                            â”‚  â”‚
â”‚  â”‚ â€¢ ë‹«íŒ ë„í˜• ê²€ì¦                                        â”‚  â”‚
â”‚  â”‚ â€¢ ì¤‘ì²© ê´€ê³„(í¬í•¨ ê´€ê³„) êµ¬ì„±                             â”‚  â”‚
â”‚  â”‚ â€¢ êµ¬ë¶„ì„ (===) ê°ì§€                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   3. Semantic Parser                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ ë°•ìŠ¤ ë‚´ë¶€ ì½˜í…ì¸  íŒŒì‹±                                 â”‚  â”‚
â”‚  â”‚ â€¢ ìš”ì†Œ ì¸ì‹ (ë²„íŠ¼, ì…ë ¥, ë§í¬ ë“±)                       â”‚  â”‚
â”‚  â”‚ â€¢ ì •ë ¬ ê³„ì‚° (ë°•ìŠ¤ ê²½ê³„ ê¸°ì¤€)                            â”‚  â”‚
â”‚  â”‚ â€¢ AST ìƒì„±                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Output (AST + Errors)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ë°ì´í„° íë¦„

```javascript
// ì…ë ¥
const input = `
+--Login--+
| #email  |
| [OK]    |
+---------+
`;

// 1ë‹¨ê³„ ì¶œë ¥: Grid
{
  cells: [
    ['+', '-', '-', 'L', 'o', 'g', 'i', 'n', '-', '-', '+'],
    ['|', ' ', '#', 'e', 'm', 'a', 'i', 'l', ' ', ' ', '|'],
    ['|', ' ', '[', 'O', 'K', ']', ' ', ' ', ' ', ' ', '|'],
    ['+', '-', '-', '-', '-', '-', '-', '-', '-', '-', '+'],
  ],
  corners: [{row: 0, col: 0}, {row: 0, col: 10}, {row: 3, col: 0}, {row: 3, col: 10}],
  width: 11,
  height: 4
}

// 2ë‹¨ê³„ ì¶œë ¥: Shapes
{
  shapes: [{
    type: 'box',
    name: 'Login',
    bounds: { top: 0, left: 0, bottom: 3, right: 10 },
    children: []
  }]
}

// 3ë‹¨ê³„ ì¶œë ¥: AST
{
  scenes: [{
    id: 'login',
    elements: [
      { type: 'input', id: 'email', position: {row: 1, col: 2} },
      { type: 'button', id: 'ok', text: 'OK', position: {row: 2, col: 2} }
    ]
  }]
}
```

---

## 4. ìƒì„¸ ì„¤ê³„

### 4.1 Grid Scanner

#### 4.1.1 Grid í´ë˜ìŠ¤

```javascript
class Grid {
  constructor(lines) {
    this.cells = lines.map(line => [...line]);
    this.height = lines.length;
    this.width = Math.max(...lines.map(l => l.length));

    // íŠ¹ìˆ˜ ë¬¸ì ì¸ë±ìŠ¤ (ë¹ ë¥¸ ì¡°íšŒìš©)
    this.cornerIndex = [];  // '+' ìœ„ì¹˜
    this.hLineIndex = [];   // '-', '=' ìœ„ì¹˜
    this.vLineIndex = [];   // '|' ìœ„ì¹˜
  }

  // ê¸°ë³¸ ì ‘ê·¼
  get(row, col) { }
  getLine(row) { }
  getRange(row, startCol, endCol) { }

  // ë°©í–¥ ìŠ¤ìº”
  scanRight(row, col, predicate) { }
  scanDown(row, col, predicate) { }
  scanLeft(row, col, predicate) { }
  scanUp(row, col, predicate) { }

  // ê²€ìƒ‰
  findAll(char) { }
  findInRange(char, bounds) { }
}
```

#### 4.1.2 Position í´ë˜ìŠ¤

```javascript
class Position {
  constructor(row, col) {
    this.row = row;
    this.col = col;
  }

  // ì´ë™
  right(n = 1) { return new Position(this.row, this.col + n); }
  down(n = 1) { return new Position(this.row + n, this.col); }
  left(n = 1) { return new Position(this.row, this.col - n); }
  up(n = 1) { return new Position(this.row - n, this.col); }

  // ë¹„êµ
  equals(other) { }
  isWithin(bounds) { }

  // í¬ë§·íŒ…
  toString() { return `(${this.row}, ${this.col})`; }
}
```

### 4.2 Shape Detector

#### 4.2.1 ë°•ìŠ¤ ì¶”ì  ì•Œê³ ë¦¬ì¦˜

```
ì•Œê³ ë¦¬ì¦˜: TraceBox(grid, startCorner)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì…ë ¥: ê·¸ë¦¬ë“œ, ì¢Œìƒë‹¨ ì½”ë„ˆ ìœ„ì¹˜
ì¶œë ¥: Box ê°ì²´ ë˜ëŠ” null (ì‹¤íŒ¨ ì‹œ)

1. ì‹œì‘ ìœ„ì¹˜ê°€ '+' ì¸ì§€ í™•ì¸
2. ì˜¤ë¥¸ìª½ìœ¼ë¡œ '-' ì¶”ì  â†’ ìš°ìƒë‹¨ ì½”ë„ˆ(+) ì°¾ê¸°
   - ì‹¤íŒ¨ ì‹œ: UNCLOSED_BOX_TOP ì—ëŸ¬
3. ì•„ë˜ë¡œ '|' ì¶”ì  â†’ ìš°í•˜ë‹¨ ì½”ë„ˆ(+) ì°¾ê¸°
   - ì‹¤íŒ¨ ì‹œ: UNCLOSED_BOX_RIGHT ì—ëŸ¬
4. ì™¼ìª½ìœ¼ë¡œ '-' ì¶”ì  â†’ ì¢Œí•˜ë‹¨ ì½”ë„ˆ(+) ì°¾ê¸°
   - ì‹¤íŒ¨ ì‹œ: UNCLOSED_BOX_BOTTOM ì—ëŸ¬
5. ìœ„ë¡œ '|' ì¶”ì  â†’ ì‹œì‘ì  í™•ì¸
   - ì‹¤íŒ¨ ì‹œ: UNCLOSED_BOX_LEFT ì—ëŸ¬
6. ë°•ìŠ¤ ì´ë¦„ ì¶”ì¶œ (ìƒë‹¨ ê²½ê³„ì—ì„œ)
7. Box ê°ì²´ ë°˜í™˜
```

**ì‹œê°ì  ì„¤ëª…:**

```
  ì‹œì‘(1)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶(2)
    +--------Name--------+
    â”‚                    â”‚
    â”‚                    â”‚
    â”‚                    â”‚
    â–²                    â–¼
    â”‚                    â”‚
    â”‚                    â”‚
   (5)                  (3)
    +--------------------+
  (4)â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

#### 4.2.2 ì¤‘ì²© ê°ì§€

```javascript
class HierarchyBuilder {
  build(shapes) {
    // ë©´ì  ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (í° ë°•ìŠ¤ê°€ ë¶€ëª¨)
    const sorted = shapes.sort((a, b) => b.area - a.area);

    for (const shape of sorted) {
      // ìì‹ ì„ ì™„ì „íˆ í¬í•¨í•˜ëŠ” ê°€ì¥ ì‘ì€ ë°•ìŠ¤ ì°¾ê¸°
      shape.parent = sorted.find(s =>
        s !== shape && this.contains(s, shape)
      );

      if (shape.parent) {
        shape.parent.children.push(shape);
      }
    }

    // ë£¨íŠ¸ ë…¸ë“œë“¤ë§Œ ë°˜í™˜
    return sorted.filter(s => !s.parent);
  }

  contains(outer, inner) {
    return outer.bounds.top < inner.bounds.top &&
           outer.bounds.left < inner.bounds.left &&
           outer.bounds.bottom > inner.bounds.bottom &&
           outer.bounds.right > inner.bounds.right;
  }
}
```

### 4.3 Semantic Parser

#### 4.3.1 ìš”ì†Œ íŒŒì„œ

ê° ìš”ì†Œ íƒ€ì…ë³„ íŒŒì„œë¥¼ ë¶„ë¦¬í•˜ì—¬ í™•ì¥ì„± í™•ë³´:

```javascript
// íŒŒì„œ ì¸í„°í˜ì´ìŠ¤
interface ElementParser {
  // í•´ë‹¹ íŒ¨í„´ì¸ì§€ í™•ì¸
  canParse(content: string): boolean;

  // íŒŒì‹± ì‹¤í–‰
  parse(content: string, position: Position): Element | null;

  // ìš°ì„ ìˆœìœ„ (ë†’ì„ìˆ˜ë¡ ë¨¼ì € ì‹œë„)
  priority: number;
}

// ë²„íŠ¼ íŒŒì„œ
class ButtonParser implements ElementParser {
  priority = 100;

  canParse(content) {
    return /\[\s*[^\]]+\s*\]/.test(content);
  }

  parse(content, position) {
    const match = content.match(/\[\s*([^\]]+?)\s*\]/);
    if (!match) return null;

    return {
      type: 'button',
      text: match[1],
      id: slugify(match[1]),
      position,
    };
  }
}

// ì…ë ¥ í•„ë“œ íŒŒì„œ
class InputParser implements ElementParser {
  priority = 90;

  canParse(content) {
    return /#\w+/.test(content);
  }

  parse(content, position) {
    const match = content.match(/#(\w+)/);
    if (!match) return null;

    return {
      type: 'input',
      id: match[1],
      position,
    };
  }
}
```

#### 4.3.2 íŒŒì„œ ë ˆì§€ìŠ¤íŠ¸ë¦¬

```javascript
class ParserRegistry {
  constructor() {
    this.parsers = [];
  }

  register(parser) {
    this.parsers.push(parser);
    // ìš°ì„ ìˆœìœ„ ì •ë ¬
    this.parsers.sort((a, b) => b.priority - a.priority);
  }

  parse(content, position) {
    for (const parser of this.parsers) {
      if (parser.canParse(content)) {
        const result = parser.parse(content, position);
        if (result) return result;
      }
    }

    // ê¸°ë³¸: ì¼ë°˜ í…ìŠ¤íŠ¸
    return { type: 'text', content, position };
  }
}

// ì‚¬ìš©
const registry = new ParserRegistry();
registry.register(new ButtonParser());
registry.register(new InputParser());
registry.register(new LinkParser());
registry.register(new CheckboxParser());
registry.register(new EmphasisParser());
```

#### 4.3.3 ì •ë ¬ ê³„ì‚°

ë°•ìŠ¤ ê²½ê³„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •í™•í•œ ì •ë ¬ ê³„ì‚°:

```javascript
class AlignmentCalculator {
  calculate(content, position, boxBounds) {
    const contentStart = position.col;
    const contentEnd = contentStart + content.trim().length;

    const boxLeft = boxBounds.left + 1;   // ê²½ê³„ ì œì™¸
    const boxRight = boxBounds.right - 1;
    const boxWidth = boxRight - boxLeft;

    const leftSpace = contentStart - boxLeft;
    const rightSpace = boxRight - contentEnd;

    const leftRatio = leftSpace / boxWidth;
    const rightRatio = rightSpace / boxWidth;

    // ì„ê³„ê°’ ê¸°ë°˜ íŒì •
    if (leftRatio < 0.2 && rightRatio > 0.3) {
      return 'left';
    } else if (rightRatio < 0.2 && leftRatio > 0.3) {
      return 'right';
    } else if (Math.abs(leftRatio - rightRatio) < 0.15) {
      return 'center';
    }

    return 'left'; // ê¸°ë³¸ê°’
  }
}
```

---

## 5. ì—ëŸ¬ ì‹œìŠ¤í…œ

### 5.1 ì—ëŸ¬ ë¶„ë¥˜

| ì¹´í…Œê³ ë¦¬ | ì—ëŸ¬ ì½”ë“œ | ì„¤ëª… |
|----------|-----------|------|
| **êµ¬ì¡° ì—ëŸ¬** | `UNCLOSED_BOX` | ë°•ìŠ¤ê°€ ë‹«íˆì§€ ì•ŠìŒ |
| | `MISMATCHED_WIDTH` | ìƒë‹¨/í•˜ë‹¨ ê²½ê³„ ë„ˆë¹„ ë¶ˆì¼ì¹˜ |
| | `MISALIGNED_PIPE` | ì„¸ë¡œ ê²½ê³„ ì •ë ¬ ì•ˆë¨ |
| | `OVERLAPPING_BOXES` | ë°•ìŠ¤ ê²¹ì¹¨ |
| **ë¬¸ë²• ì—ëŸ¬** | `INVALID_ELEMENT` | ì•Œ ìˆ˜ ì—†ëŠ” ìš”ì†Œ |
| | `UNCLOSED_BRACKET` | ê´„í˜¸ ë¯¸ì¢…ë£Œ |
| | `EMPTY_BUTTON` | ë¹ˆ ë²„íŠ¼ í…ìŠ¤íŠ¸ |
| **ê²½ê³ ** | `UNUSUAL_SPACING` | ë¹„ì •ìƒì ì¸ ê³µë°± |
| | `DEEP_NESTING` | ê³¼ë„í•œ ì¤‘ì²© (4ë‹¨ê³„ ì´ìƒ) |

### 5.2 ì—ëŸ¬ í´ë˜ìŠ¤

```javascript
class ParseError {
  constructor(code, position, context = {}) {
    this.code = code;
    this.position = position;
    this.context = context;
    this.severity = this.getSeverity(code);
  }

  getSeverity(code) {
    if (code.startsWith('WARN_')) return 'warning';
    return 'error';
  }
}
```

### 5.3 ìì—°ì–´ ë©”ì‹œì§€ í…œí”Œë¦¿

```javascript
const ErrorTemplates = {
  UNCLOSED_BOX: {
    title: 'ë°•ìŠ¤ê°€ ë‹«íˆì§€ ì•Šì•˜ìŠµë‹ˆë‹¤',
    message: ({ position, context }) => `
${position.row}ë²ˆì§¸ ì¤„, ${position.col}ë²ˆì§¸ ì¹¸ì—ì„œ ë°•ìŠ¤ê°€ ì—´ë ¸ì§€ë§Œ ë‹«íˆì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

${context.codeSnippet}

ğŸ’¡ í•´ê²° ë°©ë²•:
   ë°•ìŠ¤ë¥¼ ë‹«ìœ¼ë ¤ë©´ '+${'â”€'.repeat(context.expectedWidth - 2)}+' ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.
`,
  },

  MISMATCHED_WIDTH: {
    title: 'ë°•ìŠ¤ ë„ˆë¹„ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤',
    message: ({ context }) => `
ë°•ìŠ¤ì˜ ìƒë‹¨ê³¼ í•˜ë‹¨ ê²½ê³„ ë„ˆë¹„ê°€ ë‹¤ë¦…ë‹ˆë‹¤.

${context.topLine}
... (${context.lineCount}ì¤„)
${context.bottomLine}

â€¢ ìƒë‹¨: ${context.topWidth}ì¹¸
â€¢ í•˜ë‹¨: ${context.bottomWidth}ì¹¸

ğŸ’¡ í•´ê²° ë°©ë²•:
   ë‘ ê²½ê³„ì˜ ë„ˆë¹„ë¥¼ ë™ì¼í•˜ê²Œ ë§ì¶°ì£¼ì„¸ìš”.
`,
  },

  MISALIGNED_PIPE: {
    title: 'ì„¸ë¡œ ê²½ê³„ê°€ ì •ë ¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤',
    message: ({ position, context }) => `
${position.row}ë²ˆì§¸ ì¤„ì˜ '|'ê°€ ë°•ìŠ¤ ê²½ê³„ì™€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.

${context.codeSnippet}
${' '.repeat(context.expectedCol)}â†‘ ì—¬ê¸°ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤

ğŸ’¡ í•´ê²° ë°©ë²•:
   '|'ë¥¼ ${context.expectedCol}ë²ˆì§¸ ì¹¸ì— ë°°ì¹˜í•˜ì„¸ìš”.
`,
  },
};
```

### 5.4 ì—ëŸ¬ ì»¨í…ìŠ¤íŠ¸ ìƒì„±

```javascript
class ErrorContextBuilder {
  constructor(grid) {
    this.grid = grid;
  }

  // ì—ëŸ¬ ìœ„ì¹˜ ì£¼ë³€ ì½”ë“œ ìŠ¤ë‹ˆí« ìƒì„±
  buildCodeSnippet(position, radius = 2) {
    const lines = [];
    const { row } = position;

    for (let r = row - radius; r <= row + radius; r++) {
      if (r < 0 || r >= this.grid.height) continue;

      const lineNum = (r + 1).toString().padStart(4);
      const prefix = r === row ? ' â†’ ' : '   ';
      const line = this.grid.getLine(r);

      lines.push(`${prefix}${lineNum} â”‚ ${line}`);

      // ì—ëŸ¬ ìœ„ì¹˜ í‘œì‹œ
      if (r === row) {
        const pointer = ' '.repeat(position.col + 10) + '^';
        lines.push(`      â”‚ ${pointer}`);
      }
    }

    return lines.join('\n');
  }
}
```

### 5.5 ì—ëŸ¬ ì¶œë ¥ ì˜ˆì‹œ

```
âŒ ë°•ìŠ¤ê°€ ë‹«íˆì§€ ì•Šì•˜ìŠµë‹ˆë‹¤

3ë²ˆì§¸ ì¤„, 1ë²ˆì§¸ ì¹¸ì—ì„œ ë°•ìŠ¤ê°€ ì—´ë ¸ì§€ë§Œ ë‹«íˆì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

      1 â”‚ @scene: login
      2 â”‚
 â†’    3 â”‚ +---------------------------+
      â”‚ ^
      4 â”‚ |  Email: #email
      5 â”‚ |  [ Login ]
      6 â”‚

ğŸ’¡ í•´ê²° ë°©ë²•:
   ë°•ìŠ¤ë¥¼ ë‹«ìœ¼ë ¤ë©´ '+â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€+' ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âš ï¸ ë¹„ì •ìƒì ì¸ ê³µë°±ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤

7ë²ˆì§¸ ì¤„ì—ì„œ íƒ­ ë¬¸ìê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.
ASCII ì™€ì´ì–´í”„ë ˆì„ì—ì„œëŠ” ê³µë°±ë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
```

---

## 6. ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
src/parser/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ Grid.js              # 2D ê·¸ë¦¬ë“œ ìë£Œêµ¬ì¡°
â”‚   â”œâ”€â”€ Position.js          # ìœ„ì¹˜ ì •ë³´ í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ Bounds.js            # ì˜ì—­ ì •ë³´ í´ë˜ìŠ¤
â”‚   â””â”€â”€ index.js
â”‚
â”œâ”€â”€ scanner/
â”‚   â”œâ”€â”€ GridScanner.js       # ì…ë ¥ â†’ ê·¸ë¦¬ë“œ ë³€í™˜
â”‚   â”œâ”€â”€ CharacterIndex.js    # íŠ¹ìˆ˜ ë¬¸ì ì¸ë±ì‹±
â”‚   â””â”€â”€ index.js
â”‚
â”œâ”€â”€ detector/
â”‚   â”œâ”€â”€ ShapeDetector.js     # ë„í˜• ì¸ì‹ ë©”ì¸ í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ BoxTracer.js         # ë°•ìŠ¤ ê²½ê³„ ì¶”ì 
â”‚   â”œâ”€â”€ DividerDetector.js   # êµ¬ë¶„ì„  ê°ì§€
â”‚   â”œâ”€â”€ HierarchyBuilder.js  # ì¤‘ì²© ê´€ê³„ êµ¬ì„±
â”‚   â””â”€â”€ index.js
â”‚
â”œâ”€â”€ semantic/
â”‚   â”œâ”€â”€ SemanticParser.js    # ì˜ë¯¸ ë¶„ì„ ë©”ì¸ í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ ParserRegistry.js    # ìš”ì†Œ íŒŒì„œ ë ˆì§€ìŠ¤íŠ¸ë¦¬
â”‚   â”œâ”€â”€ AlignmentCalc.js     # ì •ë ¬ ê³„ì‚°
â”‚   â”œâ”€â”€ ASTBuilder.js        # AST ìƒì„±
â”‚   â”œâ”€â”€ elements/
â”‚   â”‚   â”œâ”€â”€ ButtonParser.js
â”‚   â”‚   â”œâ”€â”€ InputParser.js
â”‚   â”‚   â”œâ”€â”€ LinkParser.js
â”‚   â”‚   â”œâ”€â”€ CheckboxParser.js
â”‚   â”‚   â”œâ”€â”€ EmphasisParser.js
â”‚   â”‚   â”œâ”€â”€ TextParser.js
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â””â”€â”€ index.js
â”‚
â”œâ”€â”€ errors/
â”‚   â”œâ”€â”€ ParseError.js        # ì—ëŸ¬ í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ ErrorCode.js         # ì—ëŸ¬ ì½”ë“œ ìƒìˆ˜
â”‚   â”œâ”€â”€ ErrorTemplates.js    # ìì—°ì–´ ë©”ì‹œì§€ í…œí”Œë¦¿
â”‚   â”œâ”€â”€ ErrorContextBuilder.js # ì»¨í…ìŠ¤íŠ¸ ìƒì„±
â”‚   â””â”€â”€ index.js
â”‚
â”œâ”€â”€ WireframeParser.js       # í†µí•© íŒŒì„œ í´ë˜ìŠ¤
â””â”€â”€ index.js                 # ê³µê°œ API
```

---

## 7. êµ¬í˜„ ë¡œë“œë§µ

### Phase 1: Core Infrastructure (ê¸°ë°˜ êµ¬ì¶•)

- [ ] `Grid`, `Position`, `Bounds` í´ë˜ìŠ¤ êµ¬í˜„
- [ ] `GridScanner` êµ¬í˜„
- [ ] ê¸°ë³¸ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±

**ì˜ˆìƒ ì‘ì—…ëŸ‰**: í•µì‹¬ í´ë˜ìŠ¤ 5ê°œ

### Phase 2: Shape Detection (ë„í˜• ì¸ì‹)

- [ ] `BoxTracer` - ë°•ìŠ¤ ê²½ê³„ ì¶”ì 
- [ ] `DividerDetector` - êµ¬ë¶„ì„  ê°ì§€
- [ ] `HierarchyBuilder` - ì¤‘ì²© ê´€ê³„
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ (ë‹¤ì–‘í•œ ë°•ìŠ¤ íŒ¨í„´)

**ì˜ˆìƒ ì‘ì—…ëŸ‰**: ë„í˜• ì¸ì‹ ë¡œì§ 3ê°œ

### Phase 3: Semantic Parsing (ì˜ë¯¸ ë¶„ì„)

- [ ] `ParserRegistry` êµ¬í˜„
- [ ] ìš”ì†Œ íŒŒì„œë“¤ êµ¬í˜„ (Button, Input, Link ë“±)
- [ ] `AlignmentCalc` êµ¬í˜„
- [ ] `ASTBuilder` êµ¬í˜„

**ì˜ˆìƒ ì‘ì—…ëŸ‰**: ìš”ì†Œ íŒŒì„œ 6ê°œ + ìœ í‹¸ë¦¬í‹° 2ê°œ

### Phase 4: Error System (ì—ëŸ¬ ì‹œìŠ¤í…œ)

- [ ] `ParseError` í´ë˜ìŠ¤
- [ ] ì—ëŸ¬ í…œí”Œë¦¿ ì‘ì„±
- [ ] `ErrorContextBuilder` êµ¬í˜„
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸

**ì˜ˆìƒ ì‘ì—…ëŸ‰**: ì—ëŸ¬ ì²˜ë¦¬ 4ê°œ

### Phase 5: Integration (í†µí•©)

- [ ] `WireframeParser` í†µí•© í´ë˜ìŠ¤
- [ ] ê¸°ì¡´ APIì™€ í˜¸í™˜ì„± ìœ ì§€
- [ ] ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬
- [ ] ë¬¸ì„œí™”

**ì˜ˆìƒ ì‘ì—…ëŸ‰**: í†µí•© ë° ìµœì í™”

### Phase 6: Migration (ë§ˆì´ê·¸ë ˆì´ì…˜)

- [ ] ê¸°ì¡´ íŒŒì„œì™€ ë³‘ë ¬ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
- [ ] ê²°ê³¼ ë¹„êµ ê²€ì¦
- [ ] ì ì§„ì  ì „í™˜
- [ ] ê¸°ì¡´ ì½”ë“œ ì œê±°

---

## ë¶€ë¡

### A. ì§€ì› ìš”ì†Œ ëª©ë¡

| ìš”ì†Œ | ë¬¸ë²• | ì˜ˆì‹œ |
|------|------|------|
| ë°•ìŠ¤ | `+---+` | `+--Login--+` |
| ë²„íŠ¼ | `[ text ]` | `[ Submit ]` |
| ì…ë ¥ | `#id` | `#email` |
| ë§í¬ | `"text"` | `"Forgot password?"` |
| ì²´í¬ë°•ìŠ¤ | `[x]` / `[ ]` | `[x] Remember me` |
| ê°•ì¡° | `* text` | `* Welcome` |
| êµ¬ë¶„ì„  | `===` | `+===+` |

### B. ì°¸ê³  ìë£Œ

- [Earley Parser Algorithm](https://en.wikipedia.org/wiki/Earley_parser)
- [Parser Combinators](https://en.wikipedia.org/wiki/Parser_combinator)
- [Error Recovery in Parsers](https://www.antlr.org/papers/allstar-techreport.pdf)

---

*ë¬¸ì„œ ë²„ì „: 1.0*
*ìµœì¢… ìˆ˜ì •: 2024*
